
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>CPU Scheduling Simulator</title>
	<!-- Bootstrap CSS file -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<title>Ground Reference Simulator</title>
</head>
<body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

<script src="simulator/sim.js"></script>
<script src="schedulers/fifo.js"></script>
<script src="gui/gui.js"></script>

<header class="page-header header container-fluid" style="text-align:center">
CPU Scheduler Simulator
</header>

<style>
	/* Tooltip container */
	.tooltip {
	  position: relative;
	  display: inline-block;
	  border-bottom: 1px dotted black; /* If you want dots under the hoverable text */
	}
	
	/* Tooltip text */
	.tooltip .tooltiptext {
	  visibility: hidden;
	  width: 120px;
	  background-color: black;
	  color: #fff;
	  text-align: center;
	  padding: 5px 0;
	  border-radius: 6px;
	 
	  /* Position the tooltip text - see examples below! */
	  position: absolute;
	  z-index: 1;
	}
	
	/* Show the tooltip text when you mouse over the tooltip container */
	.tooltip:hover .tooltiptext {
	  visibility: visible;
	}

	.scheduler {
		border: 2px solid black;
		border-radius: 10px;
		text-align: center;
	}
	.schedulertitle {
		color: white;
		background-color: gray;
	}
	/* .queues {
		border: 2px solid gray;
		border-radius: 10px;
	} */
	.border {
		border: 2px solid gray;
		border-radius: 10px;
	}
</style>


<div class="row" style="text-align:center">
	<div class="col-md-12">

		<input type="button" class="postsim" value="Reset" style="border-radius: 6px;" onclick="resetSimulation();">
	</div>
</div>

<div class="row" style="text-align:center">
	<div class="col-6">
		<input type="range" class="presim" id="max_jobs_slider" min="1" max="100" onchange="document.getElementById('#max_jobs_label').innerHTML = this.value;">Max Jobs:<span id="#max_jobs_label"></span>
	</div>
	<div class="col-6">
		System Type:
		<select id="#system_type_selector" name="system_type" class="presim" onchange="systemChanged();"></select>
	</div>
</div>
<div class="row" style="text-align:center">
	<div class="col">
		<input type="button" class="presim" value="Run" style="border-radius: 6px;" onclick="runSimulation();">
	</div>
</div>

<div class="row" style="text-align:center">
	<div class="col-md-12">
		<input type="button" class="postsim" id="rev_all" value="|<<" style="border-radius: 6px;" onclick="revAll();">
		<input type="button" class="postsim" id="rev_one" value="|<" style="border-radius: 6px;" onclick="revOne();">
		<input type="button" class="postsim" id="fwd_one" value=">|" style="border-radius: 6px;" onclick="fwdOne();">
		<input type="button" class="postsim" id="fwd_all" value=">>|" style="border-radius: 6px;" onclick="fwdAll();createSchedulerUI();">
	</div>
</div>


<div class="container">
	<!-- Scheduler Box -->
	<div class="row scheduler">
		<!-- Scheduler Box -->
		<div class="container">
			<select id="#scheduler_0_selector" name="scheduler_0" class="presim"></select>
			<div class="row border">
				<!-- Queues -->
				<div class="col-10 border">
					Queues
					<div class="row border" id="#scheduler_0_queues">
						<div class="col-1 border">Pri0</div>
						<div class="col-11 border">
							<div class="row">
								<div class="col"></div><!-- consumes extra space to push things right -->
								<div class="col-1" style="border: 2px solid gray; border-radius: 4px">P12</div>
								<div class="col-1" style="border: 2px solid gray; border-radius: 4px;">P23</div>
								<div class="col-1" style="border: 2px solid orange; border-radius: 4px;">P7</div>
								<div class="col-1" style="border: 2px solid green; border-radius: 4px">P15</div>	
								<div class="col-1" style="border: 2px solid blue; border-radius: 4px">P19</div>
								<div class="col-1" style="border: 2px solid red; border-radius: 4px">P22</div>	
							</div>
						</div>
					</div>
					<div class="row border">
						<div class="col-1 border">Pri1</div>
						<div class="col-11 border">
							<div class="row">
								<div class="col"></div><!-- consumes extra space to push things right -->
								<div class="col-1" style="border: 2px solid gray; border-radius: 4px">P31</div>
								<div class="col-1" style="border: 2px solid gray; border-radius: 4px">P3</div>
								<div class="col-1" style="border: 2px solid gray; border-radius: 4px">P28</div>	
							</div>
						</div>
					</div>
				</div>
				<!-- CPUs -->
				<div class="col-md-2 border" id="#scheduler_0_cpus">
					CPUs
					<div class="row">
						<div class="col border" id="#scheduler_0_cpu_0">
							CPU0<br/>
							<div style="border: 2px solid red; border-radius: 10px; text-align: center;">P22</div>
						</div>
					</div>
					<div class="row">
						<div class="col border" id="#scheduler_0_cpu_1">
							CPU1
							<div style="border: 2px solid blue; border-radius: 10px; text-align: center;">P19</div>
						</div>
					</div>
					<div class="row">
						<div class="col border" id="#scheduler_0_cpu_2">
							CPU2
							<div style="border: 2px solid green; border-radius: 10px; text-align: center;">P15</div>
						</div>
					</div>
					<div class="row">
						<div class="col border" id="#scheduler_0_cpu_3">
							CPU3
							<div style="border: 2px solid orange; border-radius: 10px; text-align: center;">P7</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row" style="border: 2px solid gray; border-radius: 10px">
				Statistics
			</div>
		</div>
	</div>

	<div id="INSERT_MARKER">
		<div class="row">
			<div class="col">
				<div style="border: 2px solid gray; border-radius: 10px">
					Add another scheduler
				</div>
			</div>
		</div>
	</div>

	<br/><br/><br/><br/>
	<br/><br/><br/><br/>
	<br/><br/><br/><br/>
	<br/><br/><br/><br/>
	<br/><br/><br/><br/>

	<div class="row" style="text-align:center; border: 2px solid gray; border-radius: 25px">
		<div class="col-md-2" style="border: 2px solid gray; border-radius: 25px">

			Airspeed<br>
			<span id="#airspeed">N/A</span>
		</div>
		<div class="col-md-2" style="border: 2px solid gray; border-radius: 25px">
			Heading<br>
			<span id="#aircraftheading">N/A</span><br>
		</div>
	</div>
	<div class="row" style="text-align:center">
		<div class="col-md-3" style="border: 2px solid gray; border-radius: 25px">
			Ground Speed<br>
			<span id="#groundspeed">N/A</span>
		</div>
		<div class="col-md-3" style="border: 2px solid gray; border-radius: 25px">
			Ground Track<br>
			<span id="#groundtrack">N/A</span><br>
		</div>
		<div class="col-md-3" style="border: 2px solid gray; border-radius: 25px">
			Heading Correction
				<span id="#headingcorrection">N/A</span>
		</div>
	</div>
</div>

<div style="font-family: sans-serif; font-size: 20;">
</div>
<script>


	let systems = [ 
		new System("1-CPU System", 1),
		new System("2-CPU System", 2),
		new System("4-CPU System", 4),
	]

	let schedulers = [
		new RandomScheduler("Random Scheduler", systems[0]),
		new FIFOScheduler("FIFO Scheduler", systems[0]),
		new RRScheduler("Round Robin Scheduler", systems[0]),
	]

	resetSimulation();
	populateSystemSelector();
	populateSchedulerSelector(0);
	populateCPUsColumn(0)

	function systemChanged() {
		populateCPUsColumn(0)
	}

	function createProcessBox(text) {
		var new_element = document.createElement("div")
		new_element.className = "border"
		new_element.style = "min-height: 30px;"
		new_element.appendChild(document.createTextNode(text))
		return new_element
	}

	function populateSystemSelector() {
		var selectBox = document.getElementById("#system_type_selector")
		// Clear existing box
		while(selectBox.firstChild) {
			selectBox.removeChild(selectBox.firstChild)
		}
		for(i=0; i<systems.length; i++) {
			var new_option = document.createElement("option")
			new_option.value = i
			new_option.text = systems[i].name
			selectBox.appendChild(new_option)
		}
		selectBox.selectedIndex = 0
	}

	function populateSchedulerSelector(scheduler_num) {
		let id = `#scheduler_${scheduler_num}_selector`
		console.log("ID = " + id)
		var selectBox = document.getElementById(id)
		// Clear existing box
		while(selectBox.firstChild) {
			selectBox.removeChild(selectBox.firstChild)
		}
		for(i=0; i<schedulers.length; i++) {
			var new_option = document.createElement("option")
			new_option.value = i
			new_option.text = schedulers[i].name
			selectBox.appendChild(new_option)
		}
		selectBox.selectedIndex = 0
	}

	function getSchedulerID(scheduler_num) { return `#scheduler_${scheduler_num}` }
	function getSchedulerCPUsID(scheduler_num, cpu_num) { return `#scheduler_${scheduler_num}_cpu_${cpu_num}` }
	



	function populateCPUsColumn(scheduler_num) {
		let id = `#scheduler_${scheduler_num}_cpus`
		console.log("ID = " + id)
		var cpuBox = document.getElementById(id)
		// Clear existing box
		while(cpuBox.firstChild) {
			cpuBox.removeChild(cpuBox.firstChild)
		}
		cpuBox.appendChild(document.createTextNode("CPUs"))
		let selected_system = getSelectedSystem()
		console.log(JSON.stringify(selected_system))
		for(i=0; i<selected_system.cpus; i++) {
			console.log("Adding CPU"+i)
			var row_element = document.createElement("div")
			row_element.className = "row border"

			var new_element = document.createElement("div")
			new_element.className = "col border"
			new_element.id = `#scheduler_${scheduler_num}_cpu_${i}`
			new_element.appendChild(document.createTextNode("CPU" + i))
			new_element.appendChild(createProcessBox(""))

			row_element.appendChild(new_element)

			cpuBox.appendChild(row_element)
		}

	}

	function getSelectedSystem() {
		let systemTypeSelector = document.getElementById("#system_type_selector")
		console.log("System Type Selector index = " + systemTypeSelector.selectedIndex)
		return systems[systemTypeSelector.selectedIndex]
	}

	function createSchedulerUI() {
		var insertPoint = document.getElementById("INSERT_MARKER")
		var newElement = document.createElement("div")
		newElement.className = "row"
		newElement.style = "border: 2px solid yellow; border-radius: 10px; text-align: center;"
		newElement.appendChild(document.createTextNode("This is a test"))
		insertPoint.parentNode.insertBefore(newElement, insertPoint)
	}


	function resetSimulation() {
		// Disable any post-simulation UI elements and enable any pre-simulation ones
		var elements = document.querySelectorAll('.presim')
		elements.forEach((element) => element.disabled = false)
		var elements = document.querySelectorAll('.postsim')
		elements.forEach((element) => element.disabled = true)

	}

	function runSimulation() {
		// Disable any pre-simulation UI elements and enable any post-simulation ones
		var elements = document.querySelectorAll('.presim')
		elements.forEach((element) => element.disabled = true)
		var elements = document.querySelectorAll('.postsim')
		elements.forEach((element) => element.disabled = false)
		// TOOD: Actually call the simulator with parameters from the UI
	}

	function revAll() {

	}

	function revOne() {

	}

	function fwdOne() {

	}

	function fwdAll() {

	}

	function draw() {



		// var p_angle = (plane_heading - 90) * Math.PI / 180;
		// var w_angle = (wind_heading - 90)* Math.PI / 180;
		// var groundspeed_x = plane_velocity * Math.cos(p_angle) + wind_velocity * Math.cos(w_angle);
		// var groundspeed_y = plane_velocity * Math.sin(p_angle) + wind_velocity * Math.sin(w_angle);

		// document.getElementById("#airspeed").innerHTML = plane_velocity;
		// document.getElementById("#windspeed").innerHTML = wind_velocity;

	}







	// Shamelessly stolen from https://stackoverflow.com/questions/1255512/how-to-draw-a-rounded-rectangle-on-html-canvas
	/**
	 * Draws a rounded rectangle using the current state of the canvas.
	 * If you omit the last three params, it will draw a rectangle
	 * outline with a 5 pixel border radius
	 * @param {CanvasRenderingContext2D} ctx
	 * @param {Number} x The top left x coordinate
	 * @param {Number} y The top left y coordinate
	 * @param {Number} width The width of the rectangle
	 * @param {Number} height The height of the rectangle
	 * @param {Number} [radius = 5] The corner radius; It can also be an object
	 *				 to specify different radii for corners
	 * @param {Number} [radius.tl = 0] Top left
	 * @param {Number} [radius.tr = 0] Top right
	 * @param {Number} [radius.br = 0] Bottom right
	 * @param {Number} [radius.bl = 0] Bottom left
	 * @param {Boolean} [fill = false] Whether to fill the rectangle.
	 * @param {Boolean} [stroke = true] Whether to stroke the rectangle.
	 */
	function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
		if (typeof stroke == 'undefined') {
			stroke = true;
		}
		if (typeof radius === 'undefined') {
			radius = 5;
		}
		if (typeof radius === 'number') {
			radius = {tl: radius, tr: radius, br: radius, bl: radius};
		} else {
			var defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0};
			for (var side in defaultRadius) {
				radius[side] = radius[side] || defaultRadius[side];
			}
		}
		ctx.beginPath();
		ctx.moveTo(x + radius.tl, y);
		ctx.lineTo(x + width - radius.tr, y);
		ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
		ctx.lineTo(x + width, y + height - radius.br);
		ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
		ctx.lineTo(x + radius.bl, y + height);
		ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
		ctx.lineTo(x, y + radius.tl);
		ctx.quadraticCurveTo(x, y, x + radius.tl, y);
		ctx.closePath();
		if (fill) {
			ctx.fill();
		}
		if (stroke) {
			ctx.stroke();
		}

	}


	document.addEventListener('keydown', function(event) {
		if(event.keyCode == 37) {
			adjustPlaneHeading(-heading_increment);
		} else if(event.keyCode == 39) {
			adjustPlaneHeading(heading_increment)
		} else if(event.keyCode == 90) { // "z"
			adjustWindHeading(-heading_increment);
		} else if(event.keyCode == 88) { // "x"
			adjustWindHeading(heading_increment);
		} else if(event.keyCode == 81) { // "q"
			adjustWindspeed(velocity_increment);
		} else if(event.keyCode == 65) { // "a"
			adjustWindspeed(-velocity_increment);
		}
	});

	function wheelMoved(e) {
		console.debug("Moved " + e.deltaY);
	}

	draw();


</script>
</body>
</html>

